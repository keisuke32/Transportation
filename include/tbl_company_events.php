<?php

/**
 * 	Dear developer!
 *	Never modify events.php file, it is autogenerated.
 *  Modify PHP/EventTemplates/events.txt instead.
 *
 */

 class eventclass_tbl_company  extends eventsBase
{
	function __construct()
	{
	// fill list of events

		$this->events["BeforeQueryList"]=true;

		$this->events["BeforeShowEdit"]=true;



	}

//	handlers

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
				// List page: Before SQL query
function BeforeQueryList(&$strSQL, &$strWhereClause, &$strOrderBy, $pageObject)
{

		
// If the user belongs to the "CompanyAdministrator" group then modify the where clause to only display the company record for the users company
$groups = Security::getUserGroups();
if( $groups["CompanyAdministrator"] ) {
  $strWhereClause = whereAdd($strWhereClause, "ID = '" . $_SESSION["CompanyID"] . "'");
}



// Place event code here.
// Use "Add Action" button to add code snippets.
;		
} // function BeforeQueryList

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
				// Before display
function BeforeShowEdit(&$xt, &$templatefile, $values, $pageObject)
{

		

//Code updated by ccarvalho on December 30, 2020
$groups = Security::getUserGroups();
if( $groups["CompanyAdministrator"] && $_SESSION["CompanyID"] != $values["ID"]) {
// Log URL manipulation event

  $data = array();
  $data["ip"] = $_SERVER['REMOTE_ADDR'];
  $data["user"]  = Security::getUserName();
  $data["action"] = "URL Manipulation";
  $data["description"] = "Suspected URL maniplulation";
  DB::Insert("targettransportation104_v1_audit", $data );

//Log user out  
  Security::logout(); 

//**********  Redirect to Login page  ************
  header("Location: login.php");
  exit();
}

//Code updated by ccarvalho on January 11, 2020
if ($values["Type"] == "Vendor") {
        echo "<script language=\"Javascript\"> var DisplayCarrierTab = 1; </script>";
                } else { 
        echo "<script language=\"Javascript\"> var DisplayCarrierTab = 0; </script>";
}

// Place event code here.
// Use "Add Action" button to add code snippets.
;		
} // function BeforeShowEdit

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		



}
?>
